============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-9.0.2, pluggy-1.6.0
rootdir: /app
configfile: pyproject.toml
testpaths: tests
plugins: devtools-0.12.2, langsmith-0.4.59, mock-3.15.1, hypothesis-6.148.7, anyio-4.12.0, cov-7.0.0, logfire-4.16.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 18 items

tests/integration/test_workflow.py .                                     [  5%]
tests/unit/test_config.py ........                                       [ 50%]
tests/unit/test_database.py ....F                                        [ 77%]
tests/unit/test_labeling_engine.py ..                                    [ 88%]
tests/unit/test_workflow_orchestrator.py ..                              [100%]

=================================== FAILURES ===================================
________________________ test_database_connection_error ________________________

tmp_path = PosixPath('/tmp/pytest-of-jules/pytest-36/test_database_connection_error0')

    def test_database_connection_error(tmp_path):
        """Tests that a connection error is handled gracefully."""
        db_path = tmp_path / "non_existent_dir" / "test.db"
        db_wrapper = AseDBWrapper(db_path=str(db_path))
        with pytest.raises(OSError):
>           db_wrapper.add_atoms(Atoms("H"))

tests/unit/test_database.py:94:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
src/mlip_autopipec/database.py:41: in add_atoms
    with self._connect() as db:
         ^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/ase/db/sqlite.py:188: in __enter__
    self.connection = self._connect()
                      ^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <ase.db.sqlite.SQLite3Database object at 0x7fb1ceda2e70>

    def _connect(self):
>       return sqlite3.connect(self.filename, timeout=20)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       sqlite3.OperationalError: unable to open database file

.venv/lib/python3.12/site-packages/ase/db/sqlite.py:183: OperationalError
=============================== warnings summary ===============================
tests/integration/test_workflow.py::test_label_and_train_workflow
tests/unit/test_labeling_engine.py::test_label_structure_success
tests/unit/test_labeling_engine.py::test_label_structure_qe_failure
  /app/.venv/lib/python3.12/site-packages/ase/io/espresso_namelist/namelist.py:107: DeprecationWarning: Use of kwarg(s) as keyword(s) is deprecated,use input_data instead
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.12-final-0 _______________

Name                                                Stmts   Miss  Cover   Missing
---------------------------------------------------------------------------------
src/mlip_autopipec/__init__.py                          0      0   100%
src/mlip_autopipec/cli.py                              29      3    90%   15-16, 54
src/mlip_autopipec/config.py                           35      0   100%
src/mlip_autopipec/database.py                         36      2    94%   80-81
src/mlip_autopipec/factories.py                        15      0   100%
src/mlip_autopipec/interfaces.py                       20      5    75%   15, 24, 38, 43, 61
src/mlip_autopipec/modules/__init__.py                  0      0   100%
src/mlip_autopipec/modules/explorer_sampler.py          0      0   100%
src/mlip_autopipec/modules/labeling_engine.py          36      0   100%
src/mlip_autopipec/modules/simulation_engine.py         0      0   100%
src/mlip_autopipec/modules/structure_generator.py       0      0   100%
src/mlip_autopipec/modules/training_engine.py          15      2    87%   34-35
src/mlip_autopipec/runners.py                           6      0   100%
src/mlip_autopipec/workflow.py                         16      0   100%
---------------------------------------------------------------------------------
TOTAL                                                 208     12    94%
=========================== short test summary info ============================
FAILED tests/unit/test_database.py::test_database_connection_error - sqlite3....
=================== 1 failed, 17 passed, 3 warnings in 3.14s ===================
