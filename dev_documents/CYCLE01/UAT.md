# Cycle 01: Core Engine - User Acceptance Test (UAT) Document

**Version:** 1.0.0
**Status:** Final
**Cycle:** 01
**Title:** UAT for Core Engine: Automated Labelling and Delta Learning Training

## 1. Test Scenarios

This document outlines the User Acceptance Tests (UAT) for the functionality developed in Cycle 01. The focus of this cycle is to establish the core capability of the system: processing a single atomic structure to generate DFT labels and subsequently training a basic Machine Learning Interatomic Potential (MLIP). These tests are designed to be executed by a user (e.g., a computational scientist) to verify that the system meets the fundamental requirements from their perspective. The user will interact with the system via the command-line interface developed in this cycle, using a simple, well-defined test case, such as a Silicon bulk unit cell. The primary goal is to confirm that the main workflow is functional, produces predictable outputs, and handles basic success and failure cases gracefully.

| Scenario ID | Test Scenario Description                                                                | Priority |
| :---------- | :--------------------------------------------------------------------------------------- | :------- |
| UAT-C01-01  | **Successful End-to-End Workflow:** Verify a successful run from a structure file to a trained MLIP model. | High     |
| UAT-C01-02  | **Verification of DFT Labels:** Confirm that the DFT energy and forces stored in the database are physically correct and reasonable. | High     |
| UAT-C01-03  | **Verification of Delta Learning:** Check that the training process correctly uses the Delta Learning approach by comparing outputs with a non-delta run. | Medium   |
| UAT-C01-04  | **Handling of Failed DFT Calculation:** Ensure the system correctly detects and reports a failed (non-converged) DFT calculation without crashing. | High     |

### Scenario Details

**UAT-C01-01: Successful End-to-End Workflow**
This is the primary "happy path" test. The user will provide the system with a valid atomic structure file (e.g., a POSCAR or CIF file for bulk Silicon). The user will then execute the main script for the Cycle 01 workflow. The acceptance criterion is that the script runs to completion without any errors or crashes. At the end of the run, the system must report a success message and provide the file path to a newly created MLIP model file. The user must then verify that a file actually exists at the specified location and that it is not empty. This test confirms the successful integration of the Labelling Engine and the Training Engine and ensures the fundamental data pipeline is working as expected.

**UAT-C01-02: Verification of DFT Labels**
This test focuses on the correctness of the Labelling Engine (Module C). After running the workflow as in UAT-C01-01, the user will use a separate script or a database browser to inspect the ASE database file generated by the system. The user will retrieve the record corresponding to the input Silicon structure. The acceptance criteria are twofold: 1) The stored total energy must be a negative floating-point number within an expected range for bulk Silicon (e.g., between -100 and -200 eV for a 2-atom cell). 2) The forces on the atoms should be very close to zero (e.g., < 1.0e-4 eV/Ã…), as the input structure is a perfect, symmetric crystal, and thus the atoms are in their equilibrium positions. This test validates that the interface with Quantum Espresso is working correctly and that the output parsing logic is accurate.

**UAT-C01-03: Verification of Delta Learning**
This test ensures that the Delta Learning mechanism in the Training Engine (Module D) is being correctly applied. The user will perform two separate training runs. First, they will run the standard workflow with Delta Learning enabled in the configuration file. Second, they will modify the configuration file to disable Delta Learning and re-run the training on the same DFT data. The acceptance criterion is that the two resulting MLIP model files are different. While a quantitative comparison is complex, a simple file hash (e.g., `md5sum`) check is sufficient to prove that the training process followed a different path. This confirms that the configuration to switch between direct and delta learning is functional and has a tangible effect on the output.

**UAT-C01-04: Handling of Failed DFT Calculation**
This test verifies the system's robustness. The user will deliberately create a faulty Quantum Espresso input configuration. For example, they will provide a configuration that sets the electronic convergence threshold (`etot_conv_thr`) to an impossibly small number, guaranteeing that the SCF calculation will not converge. The user then runs the workflow. The acceptance criterion is that the system does not crash with an unhandled exception. Instead, it should gracefully terminate the DFT calculation, log an informative error message to the console (e.g., "Quantum Espresso SCF failed to converge"), and record the failure status in the ASE database for that structure. The Training Engine should not be triggered. This test ensures the error handling within the Labelling Engine is working correctly.

## 2. Behavior Definitions

The following behavior definitions are written in Gherkin style to provide a clear, unambiguous description of the expected system behavior for the key test scenarios.

---

**Scenario: UAT-C01-01 - Successful End-to-End Workflow**

**GIVEN** I have a valid atomic structure file named `Si_bulk.cif`.
**AND** I have a configuration file `cycle01_config.yaml` specifying the path to the Quantum Espresso executable and enabling Delta Learning.
**WHEN** I execute the command `python -m mlip_autopipec.main_cycle01 --config cycle01_config.yaml --structure Si_bulk.cif`.
**THEN** the script should run without raising any errors.
**AND** the script's output should contain a success message, for example, "Workflow complete. Model saved to: models/trained_model.pt".
**AND** a file named `trained_model.pt` must exist in the `models/` directory.
**AND** the file size of `trained_model.pt` must be greater than zero.

---

**Scenario: UAT-C01-02 - Verification of DFT Labels**

**GIVEN** I have successfully completed the workflow from scenario UAT-C01-01.
**AND** a database file named `mlip.db` exists.
**WHEN** I inspect the latest entry in the `mlip.db` database.
**THEN** the entry's 'total_energy_ev' should be a value less than 0.
**AND** the maximum absolute value of any component of the atomic 'forces' should be less than 0.0001.

---

**Scenario: UAT-C01-03 - Verification of Delta Learning**

**GIVEN** I have successfully completed the workflow from scenario UAT-C01-01 and have a model file `model_delta.pt`.
**AND** I have modified the `cycle01_config.yaml` to set `delta_learn: false`.
**WHEN** I re-run the training process on the same data to produce a new model file `model_direct.pt`.
**THEN** the file hash of `model_delta.pt` must not be the same as the file hash of `model_direct.pt`.

---

**Scenario: UAT-C01-04 - Handling of Failed DFT Calculation**

**GIVEN** I have a valid atomic structure file named `Si_bulk.cif`.
**AND** I have a configuration file `cycle01_config_fail.yaml` where the DFT convergence threshold is set to an impossibly strict value.
**WHEN** I execute the command `python -m mlip_autopipec.main_cycle01 --config cycle01_config_fail.yaml --structure Si_bulk.cif`.
**THEN** the script should run without raising any unhandled exceptions.
**AND** the script's output should contain an error message, for example, "ERROR: Labelling failed for Si_bulk.cif. Reason: SCF did not converge."
**AND** the script must not proceed to the training step.
**AND** when I inspect the corresponding entry in the `mlip.db` database, its 'was_successful' field should be `false`.

---
