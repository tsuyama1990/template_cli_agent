# CYCLE01/UAT.md

## 1. Test Scenarios

User Acceptance Testing (UAT) for Cycle 1 will focus on verifying that the core engine of the MLIP-AutoPipe system functions correctly and provides a seamless user experience for the fundamental workflow. The primary user story for this cycle is: "As a computational materials scientist, I want to provide a set of pre-existing atomic structures in a database, and have the system automatically calculate their DFT properties and train a baseline MLIP from this data." The UAT will be conducted via a single, well-documented Jupyter Notebook (`uat_cycle01.ipynb`) that guides the user through the entire process, making the verification interactive and transparent.

| Scenario ID | Scenario Description                                                                | Priority |
| :---------- | :---------------------------------------------------------------------------------- | :------- |
| UAT-C01-01  | **Verify Successful End-to-End Workflow Execution**                                 | High     |
|             | The user will execute the main CLI command on a pre-populated ASE database containing a few simple atomic structures (e.g., a 2-atom Silicon primitive cell and its slightly strained variants). The primary goal is to ensure the `Label -> Train` workflow completes without errors and produces the expected artifacts. |          |
| UAT-C01-02  | **Validate DFT Output Correctness**                                                 | High     |
|             | The user will inspect the results of the DFT calculations stored in the database. They will verify that the calculated energy and forces for a simple, known system (like the Si dimer) are physically reasonable and consistent with expected values from manual calculations or literature. This test builds trust in the automated `LabelingEngine`. |          |
| UAT-C01-03  | **Validate the Trained MLIP Model**                                                 | Medium   |
|             | The user will load the MLIP model artifact generated by the `TrainingEngine`. They will then use this model to predict the energy and forces for the same structures that were used for training. The goal is to verify that the model has learned the training data correctly, i.e., its predictions should closely match the DFT labels. A simple plot of MLIP predictions vs. DFT values will be generated to visually confirm the correlation. |          |

## 2. Behavior Definitions

The behavior of the system will be defined using the Gherkin-style (GIVEN/WHEN/THEN) syntax to ensure clarity and precision. These definitions will be implemented as interactive steps within the `uat_cycle01.ipynb` notebook.

### Scenario: UAT-C01-01 - Verify Successful End-to-End Workflow Execution

*   **GIVEN** a clean working directory.
*   **AND** the user has created a configuration file (`cycle01_config.yaml`) specifying the path to an ASE database and parameters for the DFT and training steps.
*   **AND** the user has programmatically created an ASE database file (`cycle01_uat.db`) and populated it with three atomic structures: a Silicon primitive cell at its equilibrium distance, a slightly compressed version, and a slightly stretched version.
*   **WHEN** the user executes the command `uv run mlip-pipe run-cycle --config cycle01_config.yaml` in the terminal.
*   **THEN** the command should execute and finish without raising any unhandled exceptions, and it should return an exit code of 0.
*   **AND** the system should print informative log messages to the console, indicating the start and successful completion of the "Labeling" stage and the "Training" stage.
*   **AND** a new file, the trained model artifact (e.g., `trained_model.pt`), should be present in the working directory.

### Scenario: UAT-C01-02 - Validate DFT Output Correctness

*   **GIVEN** the successful completion of the workflow from scenario UAT-C01-01.
*   **AND** the user has connected to the output ASE database (`cycle01_uat.db`) using the ASE Python library within the Jupyter Notebook.
*   **WHEN** the user queries the database for the records of the three Silicon structures.
*   **THEN** each record should now contain new key-value pairs for `dft_energy`, `dft_forces`, and `dft_stress`.
*   **AND** the values should not be null or empty.
*   **AND** the calculated energy for the equilibrium structure should be lower than the energies for both the compressed and stretched structures, correctly reflecting the physical potential energy well.
*   **AND** the forces on the atoms in the equilibrium structure should be close to zero, while the forces on the strained structures should be non-zero and act in the direction that would restore the atoms to equilibrium (i.e., pointing outwards for the compressed case, inwards for the stretched case).

### Scenario: UAT-C01-03 - Validate the Trained MLIP Model

*   **GIVEN** the successful completion of the workflow from scenario UAT-C01-01.
*   **AND** the user has loaded the trained MLIP model artifact (`trained_model.pt`) into memory using the appropriate library (`torch.load`).
*   **AND** the user has retrieved the DFT-labeled structures and their corresponding DFT energies/forces from the `cycle01_uat.db` database.
*   **WHEN** the user iterates through each structure and uses the loaded MLIP model to calculate the predicted energy and forces.
*   **THEN** the predicted energy for each structure should be very close to the `dft_energy` stored in the database for that structure (e.g., within 1e-4 eV).
*   **AND** the predicted forces for each structure should be very close to the `dft_forces` stored in the database.
*   **AND** the notebook will generate a "parity plot" (MLIP-predicted energy vs. DFT energy) for all data points.
*   **AND** all points on the plot should lie very close to the y=x line, visually demonstrating that the model has successfully learned the training data.
