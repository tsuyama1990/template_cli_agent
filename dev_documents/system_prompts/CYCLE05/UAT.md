# CYCLE05/UAT.md

## 1. Test Scenarios

User Acceptance Testing (UAT) for Cycle 5 is designed to validate the advanced, high-fidelity features that make MLIP-AutoPipe a production-ready scientific tool. The user stories for this cycle are: 1) "As a solid-state physicist, I need to model magnetic materials accurately, so the system must be able to handle magnetism and spin-orbit coupling in its DFT calculations." 2) "As a materials scientist studying long-term phenomena, I need to run simulations like Kinetic Monte Carlo (kMC) to understand diffusion, and the system should support this using the generated potential." The UAT will be conducted via a Jupyter Notebook (`uat_cycle05.ipynb`) that demonstrates these advanced capabilities on appropriate material systems.

| Scenario ID | Scenario Description                                                                | Priority |
| :---------- | :---------------------------------------------------------------------------------- | :------- |
| UAT-C05-01  | **Validate Automated Magnetism Handling in DFT**                                    | High     |
|             | The user will run the pipeline for a known magnetic material (e.g., body-centered cubic Iron, "Fe"). They will enable the magnetism settings in the configuration. The UAT will focus on verifying that the generated Quantum Espresso input files correctly include the parameters for a spin-polarized calculation and that the resulting DFT energy is consistent with known values for magnetic iron. |          |
| UAT-C05-02  | **Verify Advanced kMC Simulation Mode**                                             | Medium   |
|             | After generating a potential for a simple alloy with a known vacancy diffusion mechanism (e.g., Copper with a single vacancy), the user will run the system in the new "kMC analysis" mode. They will verify that the system successfully runs a kMC simulation and outputs physically meaningful results, such as a plot of the vacancy's mean squared displacement over time. |          |
| UAT-C05-03  | **Confirm High-Quality User Documentation**                                         | High     |
|             | The user will follow the new tutorial Jupyter Notebook (`docs/tutorial.ipynb`) from start to finish. They will verify that all steps are clear, all commands work as described, and that by the end of the tutorial, they have successfully generated a valid potential and used it to perform a simple analysis. This UAT validates the overall user experience and polish of the system. |          |

## 2. Behavior Definitions

The behavior of the system will be defined using the Gherkin-style (GIVEN/WHEN/THEN) syntax. These definitions will be implemented as interactive steps within the `uat_cycle05.ipynb` notebook.

### Scenario: UAT-C05-01 - Validate Automated Magnetism Handling in DFT

*   **GIVEN** a minimal `input.yaml` for Iron ("Fe").
*   **AND** a configuration file that includes a `dft_compute` section with magnetism enabled (e.g., `magnetism: {initialization_strategy: "ferromagnetic"}`).
*   **WHEN** the user runs the pipeline to generate and label a single structure of bcc Fe.
*   **THEN** the workflow should complete successfully.
*   **AND** the user will inspect the Quantum Espresso input file that was generated by the `LabelingEngine` (the system will be configured to save these for inspection).
*   **AND** the input file should contain the line `nspin = 2` and a `starting_magnetization` card, confirming that a spin-polarized calculation was configured.
*   **AND** the user will connect to the ASE database and check the calculated DFT energy for the Fe atom.
*   **AND** the energy should be consistent with the expected value for ferromagnetic iron, which is significantly lower than the energy for non-magnetic iron, thus validating that the physics was captured correctly.

### Scenario: UAT-C05-02 - Verify Advanced kMC Simulation Mode

*   **GIVEN** a high-quality MLIP for Copper (`Cu_potential.pt`) has already been generated by the pipeline in a previous step.
*   **AND** the user has created a configuration file that specifies the simulation mode as kMC (e.g., `simulation: {mode: "kmc_analysis"}`) and points to the pre-existing potential.
*   **AND** the user has provided a starting structure of a 3x3x3 Cu supercell with a single vacancy.
*   **WHEN** the user executes the main CLI command in analysis mode: `uv run mlip-pipe analyze --config kmc_config.yaml`.
*   **THEN** the command should execute and complete without errors.
*   **AND** the system should produce output files containing the results of the kMC simulation, including a log of accepted kMC moves.
*   **AND** the Jupyter notebook will load the kMC results and generate a plot of the vacancy's Mean Squared Displacement (MSD) vs. time.
*   **AND** the MSD plot should show a clear, positive linear trend, which is the correct physical signature of a diffusive process, confirming the kMC simulation was successful.

### Scenario: UAT-C05-03 - Confirm High-Quality User Documentation

*   **GIVEN** a fresh installation of the MLIP-AutoPipe package.
*   **AND** the user has opened the main tutorial notebook located at `docs/tutorial.ipynb`.
*   **WHEN** the user executes the notebook cells sequentially from top to bottom.
*   **THEN** every cell should execute without errors.
*   **AND** the instructions and explanations provided in the markdown cells should be clear, accurate, and easy to understand for a graduate student in materials science.
*   **AND** by completing the notebook, the user should have successfully run a minimal end-to-end workflow and generated a final plot (e.g., an energy vs. volume curve) that validates the created potential.
