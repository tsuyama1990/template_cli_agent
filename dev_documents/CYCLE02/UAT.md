# UAT.md - Cycle 02: Architect Agent (`gen-cycles` command)

## 1. Test Scenarios

This document outlines the User Acceptance Testing (UAT) scenarios for Cycle 02 of the AC-CDD project. The central focus of this cycle is the `gen-cycles` command, the user's gateway to the AI Architect Agent. The primary goal of these tests is to verify that this new, powerful feature is not only functional but also reliable, robust, and provides a good user experience. The scenarios will cover the "golden path" of successful document generation, as well as critical error-handling paths for common issues like missing input files or invalid API keys. The successful execution of these tests will confirm that the system can reliably automate the entire architectural and project planning phase of development.

| Scenario ID | Description                                                    | Priority |
|-------------|----------------------------------------------------------------|----------|
| UAT-02-001  | Successful Generation of All Architectural Documents           | High     |
| UAT-02-002  | Command Fails Gracefully if `ALL_SPEC.md` Input File is Missing | High     |
| UAT-02-003  | Command Fails Gracefully on Invalid Jules API Key              | High     |
| UAT-02-004  | Command Handles an Empty `ALL_SPEC.md` File Without Crashing   | Medium   |

**Scenario Details:**

**UAT-02-001: Successful Generation of All Architectural Documents**
This is the most important scenario for this cycle, as it validates the core functionality and the primary success pathway. The test ensures that the system can correctly take a well-formed, high-level requirements document (`ALL_SPEC.md`), process it with the AI Architect Agent, and produce a complete and correctly structured set of architectural artifacts. This includes the main system architecture document, the individual specification and UAT files for each development cycle, and the plan status file. This end-to-end test confirms that all components—the CLI, the agent, the API client, the response parser, and the file writer—are working together harmoniously. Its success is a prerequisite for all subsequent development cycles, as they depend on the outputs generated by this process.

**UAT-02-002: Command Fails Gracefully if `ALL_SPEC.md` Input File is Missing**
This scenario tests the system's robustness against a very common user error: attempting to run the process without providing the necessary input. A robust system should not crash with a `FileNotFoundError` stack trace. Instead, this test verifies that the system proactively checks for the existence of the `ALL_SPEC.md` file at the beginning of the process. If the file is not found, the system must terminate the command cleanly and present the user with a clear, informative, and actionable error message. This message should explain exactly what is wrong (the file is missing) and how to fix it (create the file and add requirements), demonstrating a user-centric design approach.

**UAT-02-03: Command Fails Gracefully on Invalid Jules API Key**
This scenario tests the system's ability to handle failures in its communication with external services, which is a critical aspect of any distributed system. The user might have an incorrect or expired API key in their `.env` file. This test ensures that the `JulesClient` correctly identifies an authentication failure (e.g., a 401 or 403 HTTP status code from the API). The system must then translate this technical error into a simple, user-friendly message that points the user directly to the likely source of the problem—their `JULES_API_KEY` configuration. This prevents user confusion and frustration, making it easy to diagnose and fix the most common configuration issue.

**UAT-02-04: Command Handles an Empty `ALL_SPEC.md` File Without Crashing**
This scenario tests an important edge case. What happens if the user creates the `ALL_SPEC.md` file but leaves it empty? The system should be resilient enough to handle this. It should not crash or throw an error. Instead, it should proceed with the empty file content and send it to the Architect Agent. While the resulting architectural documents may be generic, boilerplate, or based only on the agent's intrinsic knowledge (as there were no specific requirements to work from), the key outcome is that the process completes successfully. This test verifies that the pipeline is robust and can handle empty but technically valid inputs.

## 2. Behavior Definitions

**Scenario: UAT-02-001 - Successful Generation of All Architectural Documents**

*   **GIVEN** I am a user of the AC-CDD tool and I have successfully completed the `init` process.
*   **AND** my `.env` file contains a valid and active `JULES_API_KEY`.
*   **AND** I have created a file at `dev_documents/ALL_SPEC.md` which contains the high-level functional and non-functional requirements for the software project I want to build.
*   **AND** the directories `dev_documents/CYCLE01`, `dev_documents/CYCLE02`, etc., do not yet exist.
*   **WHEN** I execute the command `uv run manage.py gen-cycles` from the root of my project.
*   **THEN** the console should display a status message, indicating that the Architect Agent has been activated and is processing the requirements.
*   **AND** after a period of processing, the console should display a clear success message, such as "Architectural blueprint generated successfully. You can now proceed to run Cycle 01."
*   **AND** a new file, `dev_documents/SYSTEM_ARCHITECTURE.md`, must have been created.
*   **AND** a series of new directories, `dev_documents/CYCLE01`, `dev_documents/CYCLE02`, and so on, must have been created, corresponding to the plan generated by the agent.
*   **AND** inside each of these newly created cycle directories, there must be a `SPEC.md` file and a `UAT.md` file.
*   **AND** a file named `dev_documents/plan_status.json` must have been created, containing a list of the generated cycle numbers.
*   **AND** the content of all generated Markdown files should be well-formatted and substantial.

**Scenario: UAT-02-002 - Command Fails Gracefully if `ALL_SPEC.md` Input File is Missing**

*   **GIVEN** I am a user of the AC-CDD tool with a valid `.env` file.
*   **AND** I have forgotten to create the `dev_documents/ALL_SPEC.md` file, or I have accidentally deleted it.
*   **WHEN** I execute the command `uv run manage.py gen-cycles`.
*   **THEN** the command should fail immediately, without attempting to contact the Jules API.
*   **AND** the system must display a specific and helpful error message in the console, such as "Error: The requirement file could not be found at 'dev_documents/ALL_SPEC.md'. Please create this file and outline your project needs before running this command.".
*   **AND** the command must terminate with a non-zero exit code to signal failure.
*   **AND** no new files or directories should be created in the `dev_documents` folder.

**Scenario: UAT-02-003 - Command Fails Gracefully on Invalid Jules API Key**

*   **GIVEN** I am a user of the AC-CDD tool.
*   **AND** I have a correctly placed `dev_documents/ALL_SPEC.md` file.
*   **AND** the `JULES_API_KEY` value in my `.env` file is incorrect, has a typo, or has been revoked.
*   **WHEN** I execute the command `uv run manage.py gen-cycles`.
*   **THEN** the system will attempt to communicate with the Jules API and will receive an authentication error.
*   **AND** the system must catch this specific error and display a user-friendly message, such as "Error: API authentication failed. Please verify that your JULES_API_KEY in the .env file is correct and active.".
*   **AND** the command must terminate with a non-zero exit code.
*   **AND** no architectural documents should be created or modified on my local filesystem.

**Scenario: UAT-02-004 - Command Handles an Empty `ALL_SPEC.md` File Without Crashing**

*   **GIVEN** I am a user with a valid `.env` file and a working `JULES_API_KEY`.
*   **AND** I have created the file `dev_documents/ALL_SPEC.md`, but the file is completely empty (size of 0 bytes).
*   **WHEN** I execute the command `uv run manage.py gen-cycles`.
*   **THEN** the system should not crash or exit with an error.
*   **AND** it should proceed to call the Architect Agent, sending the empty content as the user's requirements.
*   **AND** the command should complete successfully, displaying a success message.
*   **AND** the standard set of architectural documents (`SYSTEM_ARCHITECTURE.md`, `CYCLE{xx}/SPEC.md`, etc.) should be created.
*   **AND** the content of these generated files is expected to be generic or template-like, reflecting the absence of specific input requirements, but they must not be empty.
